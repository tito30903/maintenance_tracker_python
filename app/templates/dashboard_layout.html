<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Flask App</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/output.css') }}">
</head>
<body>
    <!-- header bar -->
    <div class="flex flex-row items-center gap-2 m-4">
        <h3 class="text-2xl">Maintenance Tracker</h3>
        <p class="inline-flex items-center h-[1.3rem] px-2 rounded-full bg-gray-200 text-xs font-semibold text-gray-700">
            Manager
        </p>

        <div class="ml-auto flex flex-row items-center gap-4 h-8">
            <button class="h-full" onclick="addTicket()">
                <img src="{{ url_for('static', filename='images/plus.png') }}" alt="plus" class="h-5 w-5 object-contain">
            </button>
            <button class="h-full">
                <img src="{{ url_for('static', filename='images/profile.png') }}" alt="profile" class="h-7 w-7 object-contain">
            </button>
        </div>
    </div>

    <!-- Overlay (hidden by default) -->
    <div id="overlay" class="fixed inset-0 backdrop-blur-xs bg-gray-200/[20%] flex items-center justify-center z-50 hidden">
        <div class="custom-border">
            <div class="flex flex-row items-center justify-between">
                <h3 class="text-2xl font-bold">Add Ticket</h3>
                <button onclick="closeOverlay()">
                    <img src="{{ url_for('static', filename='images/plus.png') }}" alt="close" class="h-6 w-6 object-contain rotate-45">
                </button>
            </div>

            <!-- input fields -->
            <div class="flex flex-col items-start">
                <label for="ticketname">
                Name
                </label>
                <input id="ticketname" type="text" class="border border-gray-300 rounded-lg">
            </div>

            <button class="btn-primary mt-2" onclick="saveTicket()">
                Save Ticket
            </button>
        </div>
    </div>

    {% block content %}{% endblock %}

    <script>
        function addTicket() {
            document.getElementById('overlay').classList.remove('hidden');
            console.log("Add Ticket button clicked");
        }
        function closeOverlay() {
            document.getElementById('overlay').classList.add('hidden');
        }

        function saveTicket() {
            const ticketName = document.getElementById('ticketname').value;
            console.log("Saving ticket:", ticketName);
            // Here you would typically send the ticket data to the server

            fetch('/api/ticket/create', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name: ticketName })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Ticket saved:', data);
                // Optionally refresh ticket list or show a success message
                document.getElementById('ticketname').value = ''; // clear input field
            })
            .catch(error => {
                console.error('Error saving ticket:', error);
            })
            .finally(closeOverlay);
        }
    </script>

    <script src="{{ url_for('static', filename='js/auth_interceptor.js') }}"></script>
    <script src="{{ url_for('static', filename='js/fetch_data_after_init.js') }}"></script>
</body>
</html>